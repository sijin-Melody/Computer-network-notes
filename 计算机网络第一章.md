# 计算机网络第一章

## 1.3 三种交换方式

①电路交换

使用一个中间设备，将这些电话连接起来。这个中间设备就是电话交换机.

电路交换的三个步骤：

![image-20230320150123855](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320150123855.png)对于计算机突发数据的传输，线路利用率不高。

②分组交换(常用的)

在因特网中最重要的分组交换机就是路由器，他负责将各种网络互联起来，并对接收到的分组进行转发，也就是在进行分组交换。

通常我们把表示该消息的整块数据称为一个报文，在发送报文之前，将报文划分成若干个等长的数据段，然后给各数据段添加首部（包含重要的控制信息）构成分组。**首部的作用：包含分组的目的地址，否则不知道如何转发分组，收到分组，先存储下来，检查首部后转发。**
结点交换机（路由器）对分组进行存储转发。
分组从源主机到目的主机，可走不同的路径。

![image-20230320150741748](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320150741748.png)

> 分组传输过程中的两种情况，一种是各分组从源站到达目的站，可以走不同的路径，也就是不同的路由。另一种是分组乱序，也就是分组到达目的站的顺序，不一定与分组在源站的发送顺序相同，对于可能出现的分组丢失、误码、重复等问题

![image-20230320150957738](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320150957738.png)

③报文交换
与分组交换类似，采用**存储转发**方式
但不限制报文的长度
对结点交换机的存储空间要求高
④三张交换方式对比

![image-20230320151329060](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320151329060.png)

- 对于电路交换，通信之前首先要建立连接，连接建立好之后，就可以使用已建立好的连接进行数据传送，数据传送结束后需要释放连接，以归还之前建立连接所占用的通信线路资源，
- 对于报文交换可以随时发送报文，而不需要事先建立连接。整个报文先传送到相邻节点交换机，全部存储下来后进行查表转发，转发到下一个节点交换机，
- 对于分组交换可以随时发送分组，而不需要事先建立连接，构成原始报文的一个个分组，依次在各节点交换机上存储转发，各节点交换机在发送分组的同时，还缓存接收到的分组。

‍

- 当使用电路交换时，一旦建立连接中间的各节点交换机就是直通形式的，比特流可以直达终点。
- 当使用报文交换时，整个报文需要在各节点交换机上进行存储转发，由于不限制报文的大小，因此需要各节点交换机都具有较大的缓存空间。
- 当使用分组交换时，构成原始报文的一个个分组，在各节点交换机上进行存储转发，相比报文交换，减少了转发时延，还可以避免过长的报文，长时间占用链路，同时也有利于进行差错控制。

******

最后我们总结一下这三种交换方式各自的优缺点。

电路交换的优点如下
第一，通信时延小，这是因为通信线路为通信双方用户专用，数据直达，因此通信时延非常小，当连续传输大量数据时，这一优点非常明显。
第二，有序传输，这是因为通信双方之间只有一条专用的通信线路，数据只在这一条线路上传输，因此不存在失序问题。
第三，没有冲突，不同的通信双方拥有不同的信道，不会出现征用物理信道的问题。
第四，使用范围广，电路交换既适用于传输模拟信号，也适用于传输数字信号。
第五，实时性强，这主要得益于其通信时延小的优点。
第六，控制简单，电路交换的节点交换机及其控制都比较简单，

电路交换的缺点如下，
第一，建立连接时间长，电路交换的平均连接建立时间对计算机通信来说太长了。
第二，线路独占，使用效率低，电路交换一旦建立连接，物理通路就被通信双方独占，即使通信线路空闲，也不能供其他用户使用，因而信道利用率很低。
第三，灵活性差，只要连接所建立的物理通路中的任何一点出现了故障，就要必须重新拨号建立新的连接，这对十分紧急和重要的通信是很不利的。
第四，难以规格化，电路交换时数据直达，不同类型不同规格不同速率的终端，很难相互进行通信，也难以在通信过程中进行差错控制。

------

报文交换的优点如下，
第一，无需建立连接，报文交换不需要为通信双方预先建立一条专用的通信线路，不存在建立连接的时延，用户可以随时发送报文。
第二，动态分配线路，当发送方把报文传送给节点交换机，时节点交换机先存储整个报文，然后选择一条合适的空闲线路，将报文发送出去。
第三，提高线路可靠性。如果某条传输路径发生故障，会重新选择另一条路径传输，数据因此，提高了传输的可靠性。
第四，提高线路利用率。通信双方不是固定占用一条通信线路，而是在不同的时间分段部分占用物理线路，因而大大提高了通信线路的利用率。
第五，提供多目标服务，一个报文可以同时发送给多个目的地址，这在电路交换中是很难实现的。

报文交换的缺点如下，
第一，引起了转发时延，这是因为报文在节点交换机上要经历存储转发的过程。
第二，需要较大的存储缓存空间，这是因为报文交换对报文的大小没有限制。
第三，需要传输额外的信息量，这是因为报文需要携带目标地址、源地址等信息，

------

分组交换的优点如下，
第一，无需建立连接，分组交换不需要为通信双方预先建立一条专用的通信线路，不存在建立连接的时延，用户可以随时发送分组。
第二，线路利用率高，通信双方不是固定占用一条通信线路，而是在不同的时间分段部分占有物理线路，因而大大提高了通信线路的利用率。
第三，简化了存储管理，这是相对于报文交换而言的，因为分组的长度固定，相应的缓冲区的大小也固定，管理起来相对容易
第四，加速传输，由于分组是逐个传输的，这就使得后一个分组的存储操作与前一个分组的转发操作可以同时进行。
第五减少出错概率和重发数据量。因为分组比报文小，因此出错概率必然减小。即便分组出错，也只需重传出错的部分，这比重传整个报文的数据量小很多，这样不仅提高了可靠性，也减少了传输时延。

分组交换的缺点如下，
第一，引起了转发时延，这是因为分组在节点交换机上要经历存储转发的过程。
第二，需要传输额外的信息量，将原始报文分割成等长的数据块，每个数据块都要加上源地址、目的地址等控制信息，从而构成分组，因此使得传送的信息量增大了。
第三，当分组交换采用数据报服务时，可能会出现失去丢失或重复分组，分组到达目的节点时，需要重新还原成原始报文，比较麻烦。若分组交换采用虚电路服务，虽然没有分组失序问题，但有呼叫建立数据传输和虚电路释放三个过程。

## 1.4 计算机网络的定义和分类

①定义

- 没有精确统一的定义
- **最简单定义**：`互连、自治、计算机集合`
- 不同阶段定义不同，反映当时的网络技术发展水平

![image-20230320153006013](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320153006013.png)

②分类

- 按网络的使用者分类，可以分为公用网，专用网，公用网是指电信公司出资建造的大型网络，公用的意思就是所有愿意按电信公司的规定，缴纳费用的人都可以使用这种网络，因此公用网也可称为公众网。专用网是指某个部门为本单位的特殊业务工作的需要而建立的网络，这种网络不向本单位以外的人提供服务，例如军队、铁路、电力等系统均有本系统的专用网，

- 按传输介质分类，可以分为有线网络和无线网络，有线网络包括双绞线网络、光纤网络等。而无线局域网所使用的WIFI技术目前应用比较普遍

- 按网络的覆盖范围分类，可以分为广域网WAN，城域网MAN，局域网LAN，个域网PAN，希望大家能记住这几个比较常见的英文缩写词，尤其是WAN，LAN和PAN。您可以看看自己家装路由器背面的各接口，很可能标记为1个WAN和多个LAN，而不是标记为中文的广域网接口和局域网接口。

  广域网的覆盖范围通常为几十公里到几千公里，可以覆盖一个国家地区，甚至横跨几个州，因而有时也称为远程网。**广域网是因特网的核心部分**，其任务是为核心路由器提供远距离，例如跨越不同的国家的高速连接，互联分布在不同区域的城域网和局域网

  城域网的覆盖范围一般是一个城市，可跨越几个街区，甚至整个城市，其作用距离为5~50公里。城域网通常作为城市骨干网，互联大量企业机构和校园局域网，近几年城域网已开始成为现代城市的信息服务基础设施，为大量用户提供接入和各种信息服务，并有趋势将传统的电信服务、有线电视服务和互联网服务融为一体。

  局域网一般用微型计算机或工作站通过高速通信线路相连，速率通常在10兆比特每秒以上，但地理上则局限在较小的范围内，如一个实验室一幢楼或一个校园内，距离一般在一公里左右，局域网通常由某个单位单独拥有使用和维护。在局域网发展的初期，一个学校或工厂往往只拥有一个局域网，现在局域网已被非常广泛的使用，一个学校或企业大都拥有许多个互联的局域网，这样的网络通常称为校园网或企业网。

  个域网是个人区域网络的简称，它不同于上述网络，**不是用来连接普通计算机的，而是在个人工作的地方把属于个人使用的电子设备，例如便携式计算机、打印机、鼠标、键盘耳机等**，用无线技术连接起来的网络，因此也常称为无线个人区域网WPAN，其覆盖范围大约为10米，

  需要注意的是若中央处理机之间的距离非常近，例如仅一米的数量级甚至更小，则一般就称之为多处理机系统，而不称它为计算机网络。

- 计算机网络还可以按拓扑结构分类，可以分为总线型网络、星型网络、环形网络和网状型网络，总线型网络使用单根传输线，把计算机连接起来。它的**优点**是建网容易增减节点方便节省线路，**缺点**是重负载时通讯效率不高，总线任意一处出现故障，则全网瘫痪。

  星型网络是将每个计算机都以单独的线路与中央设备相连。**中央设备**早期是计算机，后来是集线器，**现在一般是交换机或路由器**，这种网络拓扑便于网络的集中控制和管理，因为端用户之间的通信必须经过中央设备，缺点是成本高，中央设备对故障敏感

  环形网络是将所有计算机的网络接口连接成一个环，最典型的例子是令牌环局域网，环可以是单环，也可以是双环，环中信号是单向传输的，

  网状型网络，一般情况下，每个节点至少有两条路径与其他节点相连，多用在广域网中，其优点是可靠性高，缺点是控制复杂，线路成本高。

![image-20230320153205555](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320153205555.png)



## 1.5 计算机网络的性能指标

常用的计算机网络性能指标有以下8个，它们是速率、带宽、吞吐量、时延、时延带宽积，往返时间、利用率，丢包率

①速率
1️⃣比特

计算机中**数据量的单位**，也是信息论中信息量的单位。一个比特就是二进制数字中的一个1或0。

>**a.基本单位**：bit(b)
>
>**b.常用单位**：
>8 bit = 1 Byte
>KB = 2^10 B
>MB = K KB = 2^20 B
>GB = K MB = 2^30 B
>TB = K GB = 2^40 B

![image-20230320153907518](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320153907518.png)

2️⃣速率

连接在计算机网络上的主机在数字信道上**传送比特的速率**，也称为比特率或数据率。

>a.基本单位：bit/s(b/s，bps)
>b.常用单位：
>kb/s = 10^3 b/s
>Mb/s = K Kb/s = 10^6 b/s
>Gb/s = k Mb/s = 10^9 b/s
>Tb/s = k Gb/s = 10^12 b/s

由于储存容量和速率本来就是不同的表示方法，容量用二进制，速率是10

![image-20230320154225044](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320154225044.png)

*****

【考研2013年35题】主机甲通过1个路由器(存储转发方式)与主机乙互联，两段链路的数据传输速率均为10Mbps，主机甲分别采用报文交换和分组大小为10kb 的分组交换向主机乙发送1个大小为8Mb(1Mb=10^6^kb )的报文。若忽略链路传播延迟、分组头开销和分组拆装时间，则两种交换方式完成该报文传输所需的总时间分别为 ( )。

A．800ms、1600ms

B．801ms、1600ms

C．1600ms、800ms

D．1600ms、801ms

- 发送一个报文的时延是8Mb/10Mb/s=800ms，在接收端接收此报文的时延也是800ms，共计1600ms。 即发送时延+传播时延
- 发送一个报文的时延是10kb/10Mb/s=1ms，接收一个报文的时延也是1ms，但是在发送第二个报文时，第一个报文已经开始接收。共计有800个分组，总时间为801ms。
- 分组为10kb，发第一条的时候，路由器端在等待，第二条开始甲机和路由器可以同时运行，甲机发送完后停止，路由器传最后一条。用时800ms+1ms

②带宽
![image-20230320154942516](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320154942516.png)

出口网速有多大？你可能回答说200兆，这里我们往往省略说比特每秒。完整的描述应该是最高速率为200兆比特每秒

③吞吐量
![image-20230320155045243](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155045243.png)

④时延
1️⃣发送时延

**发送时延 = 分组长度(b) / 发送速率(b/s)**

> 发送速率 = min[网卡发送速率，信道带宽，交换机或路由器的接口速率]

2️⃣传播时延

**传播时延 = 信道长度(m) / 电磁波传播速率(m/s)**

> 电磁波传播速率：
> 自由空间：3 * 10^8 m/s
> 铜线电缆：2.3 * 10^8 m/s
> 光纤电缆：2.0 * 10^8 m/s

3️⃣处理时延

一般不方便计算。

> 这里需要说明的是有的教材中还有一个排队时延，而本课程将排队时延与处理时延合并成为处理时延

![image-20230320155238159](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155238159.png)

谁占主导？

![image-20230320155526697](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155526697.png)

本节课所介绍的4个常用的计算机网络性能指标的要点总结如下，

![image-20230320155605099](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155605099.png)

⑤时延带宽积
时延带宽积等于传播时延和带宽的乘积。
**( 时延带宽积=传播时延×带宽 )**

![image-20230320155832062](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155832062.png)

⑥往返时间RTT
**在许多情况下，因特网上的信息不仅仅单方向传输，而是双向交互**。

> 我们有时很需要知道双向交互一次所需的时间。
> 因此，往返时间RTT也是一个重要的性能指标。
> 一般来说，同步地球卫星链路的往返时延较大，为240ms。

![image-20230320155903340](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155903340.png)

⑦利用率
**信道利用率**用来表示某信道有百分之几的时间是被利用的（有数据通过）。

**网络利用率是全网络的信道利用率的加权平均。**

> 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增大。因此，信道利用率并非越高越好。
> 也不能使信道利用率太低，这会使宝贵的通信资源被白白浪费。

![image-20230320155955687](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320155955687.png)

⑧丢包率
**丢包率即分组丢失率，是指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率。**

![image-20230320160104719](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320160104719.png)

本节课所介绍的4个常用的计算机网络性能指标的要点总结如下

![image-20230320160138315](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320160138315.png)

## 1.6 计算机网络的体系结构

## ①常见的计算机网络体系结构

```
1️⃣OSI的七层体系结构
```

**从下往上依次为物理层、数据链路层、网络层、运输层、会话层、表示层、应用层。**
它是法律上的国际标准。
![在这里插入图片描述](https://img-blog.csdnimg.cn/4ec3f5ee756d4d28bd615d96ed8bb076.png)

2️⃣TCP/IP的四层体系结构

**从下往上依次为网络接口层、网际层、运输层、应用层。**
它是事实上的国际标准。
![在这里插入图片描述](https://img-blog.csdnimg.cn/77042255865d4f9fb408d384399cf5cf.png)

可靠？不可靠？

> 1.网络接口层并没有规定什么具体的内容，目的是为了可以互连各种各样的网络接口。
> 2.网际层的核心协议是IP协议，它可以互连各种不同的网络接口，并给运输层的TCP协议和UDP协议提供网络互联服务。
> 3.运输层的TCP协议在享受IP协议提供的服务后，可向应用层的相应协议（例如，HTTP，SMTP等）提供**可靠**传输的服务。
> 4.运输层的UDP协议在享受IP协议提供的服务后，可向应用层的相应协议（例如，DNS，RTP等）提供**不可靠**传输的服务。
>       因此，使用IP协议负责互连不同的网络接口（IP over everything）;IP协议可以为各种网络应用提供服务（Everything over IP）。

IP协议和TCP协议是其中非常重要的两个协议，因此用TCP和IP这两个协议来表示整个协议大家族常称为tcpip协议族

![image-20230320161006493](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320161006493.png)

3️⃣五层协议的原理体系结构

**结合OSI和TCP/IP的优点**，提出一种**五层协议的原理体系结构**，以**适用于教学**。
**五层协议的原理体系结构从下往上依次为物理层、数据链路层、网络层、运输层、应用层**

<img src="C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320161345092.png" alt="image-20230320161345092" style="zoom: 50%;" />

## ②分层的必要性

- 计算机网络是个非常复杂的系统
- 分层可将庞大而复杂的问题转化为若干较小的局部问题，
- 由简单到复杂的顺序来看看实现计算机网络要面临哪些主要问题，以及如何将这些问题划分到相应的层次，层层处理。

1️⃣我们可以将这些问题划归到物理层
![image-20230320161605708](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320161605708.png)

ps:严格来说，传输媒体并不属于物理层

2️⃣实用的计算机网络一般都由多台主机构成，例如主机ABCDE通过总线互联构成了一个总线型网络，假设我们已经解决了物理层的问题，也就是说主机间可以发送信号来传输比特0或1。我们来看看在这样一个总线型的网络上还面临什么需要解决的问题。

- 主机A要给主机C发送数据，但是表示数据的信号会通过总线传播到总线上的每一个主机。那么问题来了，主机C如何知道该数据是发给自己的，自己要接受。这就很自然的引出了如何标识网络中各主机的问题，也就是主机编制问题。大家可能听说过网卡上的**MAC地址**，其实它就是主机在网络中的地址，主机在发送数据时应该给数据附加上目的地址，当其他主机收到后，根据目的地址和自身地址来决定是否接受数据
- 这就又引出了一个问题，目的主机如何从信号所表示的一连串比特流中区分出地址和数据，也就是需要解决分组的**封装格式**问题。
- 另外对于总线型的网络，还会出现下面这种典型的问题，例如某个时刻总线是空闲的，也就是没有主机使用总线来发送数据，片刻之后，主机B和D同时向总线发送数据，这必然会造成**信号碰撞**。因此如何协调各主机征用总线也是必须要解决的问题。
- 需要说明的是这种总线型的网络早已淘汰，现在常用的是使用以太网交换机，将多台主机互联形成的交换式以太网。那么以太网交换机又是如何实现的？我们将这些问题全部划归到数据链路层。到这里大家可能会发现，只要解决了物理层和数据链路层各自所面临的问题，我们就可以实现分组在一个网络上传输了。

![image-20230320161727649](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320161727649.png)

3️⃣
在之前的例子中仅有一个网络，我们不需要对网络进行标识。而在本地中有多个网络，**如何标识各网络以及网络中的各主机**（网络和主机共同编址的问题，例如IP地址）。
源主机与目的主机之间的传输路径往往不止一条，分组从源主机到目的主机可走不同的路径，**路由器如何转发分组，如何进行路由选择。**
上述问题划归到网络层。

![image-20230320162133438](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320162133438.png)

4️⃣
某个时刻主机收到了来自服务器的分组，那么这些分组应该交给浏览器进程处理，还是应该交给QQ进程处理

如果某个分组在传输过程中出现了误码，或者由于路由器繁忙，导致路由器丢弃分组,如何处理

![image-20230320162200822](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320162200822.png)

5️⃣
通过应用进程间的交互来完成特定的网络应用。
例如：支持万维网应用的HTTP协议，支持电子邮件的SMTP协议，支持文件传送的FTP协议。
上述问题划归到应用层。

![image-20230320162422867](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320162422867.png)



## ③分层思想举例

通过浏览器进程与Web服务器进程的交互实例，演示分组逐层封装和解封的过程

假设网络拓扑如下，所示主机属于网络N1，‍‍web服务器属于网络N2。 N1和N2，通过路由器互联。我们使用主机中的浏览器‍‍来访问web服务器，当输入网址后，主机会向外部服务器发送请求，WEB服务器收到请求后，‍‍会发回相应的响应。‍‍主机的浏览器收到响应后，将其解析为具体的网页内容显示出来，‍‍需要说明的是我们给出的只是一个简化的示意过程，这是因为本节课的重点‍‍是计算机网络体系结构分层处理方法，而不是浏览器和web服务器的实际交互过程。‍‍

![image-20230320163325293](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163325293.png)

‍

主机和web服务器之间基于网络的通信，**实际上是主机中的浏览器应用进程‍‍与web服务器中的web服务器应用进程之间的基于网络的通信。**

那么体系结构的各层‍‍在整个过程中起到怎样的作用？

从主机端‍‍按体系结构自顶向下的顺序来看，应用层按HTTP协议的规定，‍‍构建一个HTTP请求报文，这是该报文的内容。‍‍

![image-20230320163339051](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163339051.png)

‍

应用层将HTTP报文‍‍交付给运输层处理，运输层给HTTP请求报文添加一个TCP首部，‍‍使之成为TCP报文段，这是TCP报文段的首部格式，该首部的作用主要是为了区分应用进程‍‍以及实现可靠传输。

![image-20230320163354882](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163354882.png)



运输层将TCP报文段交付给网络层处理，‍‍网络层给TCP报文段添加一个IP首使之质成为IP数据报，这是IP数据报的首部格式。‍‍

该首部的作用主要是为了使IP数据报可以在互联网上传输，也就是被路由器转发

![image-20230320163406803](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163406803.png)

‍

网络层将IP数据报交付给数据链路层处理，数据链路层给IP数据报添加一个首部和一个尾部，‍‍使之成为帧。‍‍假设网络N1是以太网，这是以太网帧首部的格式，‍‍该首部的作用主要是为了让帧能够在一段链路上或一个网络上传输，能够被相应的目的主机接收。

这是以太网帧尾部的格式，其作用是为了让目的主机检查所接收到的帧是否有误码。‍‍

<img src="C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163419867.png" alt="image-20230320163419867" style="zoom:50%;" />

数据链路层将帧交付给物理层，物理层将帧看作是比特流，由于网络N1是以太网，‍‍因此物理层还会给该比特流前面添加前导码，这是前导码的内容，‍‍其作用是为了让目的主机做好接收帧的准备，物理层将添加有前导码的比特流，‍‍变换成相应的信号发送到传输媒体，信号通过传输媒体到达路由器。‍‍

<img src="C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163438587.png" alt="image-20230320163438587" style="zoom: 50%;" />

‍

我们来看路由器的处理过程，

- 物理层将信号变换为比特流，然后去掉前导码后，‍‍将其交付给数据链路层，这实际上交付的是帧，
- 数据链路层将帧的首部和尾部去掉后‍‍，将其交付给网络层，‍‍这实际上交付的是IP数据报，
- 网络层解析IP数据报的首部，从中提取出目的网络地址，‍‍然后查找自身的路由表，确定转发端口，以便进行转发。‍‍
- 网络层将IP数据报交付给数据链路层，
- 数据链路层给IP数据报添加一个首部和一个尾部，‍‍使之成为帧
- 数据链路层将针交付给物理层，物理层将帧看作是比特流。由于网络N2是以太网，因此物理层还会给该比特流前面添加前导码
- 物理层将添加有前导码的比特流，变换成相应的信号发送到传输媒体，‍‍信号通过传输媒体到达web服务器。‍‍

‍

我们来看web服务器的处理过程，‍‍

- 物理层将信号变换为比特流，然后去掉前导码后，将其交付给数据链路层，‍‍这实际上交付的是**帧**
- 数据链路层将真的首部和尾部去掉后，将其交付给网络层，‍‍这实际上交付的是**IP数据报**，
- 网络层将IP数据报的首部去掉后，将其交付给运输层，‍‍这实际上交付的是**TCP报文段**，
- 运输层将TCP报文段的首部去掉后，将其交付给应用层。‍‍实际上交付的是**HTTP请求报文**，
- 应用层对HTTP请求报文进行解析，‍‍然后给主机发回HTTP响应报文

与之前的过程类似，HTTP响应报文‍‍需要在外部服务器层层封装，然后通过物理层变换成相应的信号，‍‍再通过传输媒体传输到路由器，路由器转发该响应报文给主机，主机通过物理层‍‍将收到的信号转换为比特流，之后通过逐层解封，最终取出HTTP响应报文

‍

## ④专用术语

1️⃣实体

**实体是指任何可发送或接收信息的硬件或软件进程。**

对等实体是指通信双方相同层次中的实体。

![image-20230320163752917](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163752917.png)

2️⃣协议

**协议是控制两个对等实体进行逻辑通信的规则的集合。**例如应用层对等实体，在应用层协议的控制下进行逻辑通信

![image-20230320163932523](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320163932523.png)

>之所以称为逻辑通信，是因为这种通信其实并不存在，它只是我们假设出来的一种通信，目的在于方便我们单独研究体系结构某一层，而不用考虑其他层

**协议的三要素是语法，语义，同步。**

> 语法定义所交换信息的格式。例如，IP数据报的格式。
> ![image-20230320164253403](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320164253403.png)
>
> 其中的小格子称为字段或域。数字表示字段的长度，单位是位，也就是比特。
>
> 语法就是定义了这些小格子的长度和先后顺序。换句话说，语法定义了所交换信息有哪些字段以及何种顺序构成
>
> 只需要看懂

>语义定义通信双方所要完成的操作。例如，主机HTTP的GET请求给Web服务器，Web服务器收到后执行相应的操作，然后给主机发回HTTP的响应。

>同步定义通信双方的时序关系。请注意并不是指时钟频率同步，例如这是TCP采用三报文握手建立连接的过程，
>
>![image-20230320164650981](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320164650981.png)



>对等层次之间传送的数据包称为该层的协议数据单元PDU。
>
>a.应用层：报文(message)
>b.运输层：TCP报文段(segment)或UDP用户数 据报(datagram)
>c.网络层：分组(packet)或IP数据报
>d.数据链路层：帧(frame)
>e.物理层：比特流(bit stram)

3️⃣服务

**在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务。**

要实现本层协议，还需要使用下面一层所提供的服务。

![image-20230320164817606](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320164817606.png)

协议是“水平的”，服务是“垂直的”。
实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议。也就是说，下面的协议对上面的实体是“透明”的。

**服务访问点**是指在同一系统中相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型。

> a.数据链路层的服务访问点为帧的“类型”字段。
> b.网络层的服务访问点为IP数据报首部中的“协议字段”。
> c.运输层的服务访问点为“端口号”。

**服务原语**是指上层使用下层所提供的服务必须通过与下层交换一些命令。

![image-20230320165305895](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320165305895.png)

![image-20230320165408070](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320165408070.png)







# 习题

体系结构：

![image-20230320170437548](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320170437548.png)

![image-20230320170547775](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320170547775.png)

![image-20230320170656814](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320170656814.png)

![image-20230320170705159](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320170705159.png)



![image-20230320171101455](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320171101455.png)

> 这里是tcpip，而不是tcp协议。tcoip认为可靠性是有传输层实现的，所以在网络层只提供无连接不可靠服务，在传输层有连接和无连接都提供。osi参考模型在网络层提供无连接和有连接，在传输层只提供有连接服务



![image-20230320171444746](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320171444746.png)

![image-20230320171527585](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320171527585.png)

![image-20230320182753468](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320182753468.png)

![image-20230320183038438](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320183038438.png)

![image-20230320183101208](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320183101208.png)

![image-20230320183159633](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230320183159633.png)

时延相关：

![image-20230321103002203](C:\Users\melody\AppData\Roaming\Typora\typora-user-images\image-20230321103002203.png)

